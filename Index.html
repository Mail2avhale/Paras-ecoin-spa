<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>PARAS ECOIN™</title>
  <script defer src="https://www.gstatic.com/firebasejs/9.24.0/firebase-app-compat.js"></script>
  <script defer src="https://www.gstatic.com/firebasejs/9.24.0/firebase-auth-compat.js"></script>
  <script defer src="https://www.gstatic.com/firebasejs/9.24.0/firebase-firestore-compat.js"></script>
  <style>
    body{font-family:sans-serif;background:#f0f4f8;color:#333;display:flex;flex-direction:column;align-items:center;padding:20px;}
    .card{background:white;padding:20px;border-radius:10px;box-shadow:0 2px 8px rgba(0,0,0,0.1);max-width:400px;width:100%;text-align:center;margin:10px 0;}
    input, button{width:90%;padding:10px;margin:5px 0;font-size:16px;}
    button{background:#6a0dad;color:#fff;border:none;border-radius:6px;cursor:pointer;}
    button:hover{background:#580b9a;}
    .vip{font-weight:bold;color:#ba8a00;}
  </style>
</head>
<body>
  <h1>PARAS ECOIN</h1>

  <div id="auth-card" class="card">
    <input id="email" type="email" placeholder="Email">
    <input id="password" type="password" placeholder="Password">
    <button id="signupBtn">Sign Up</button>
    <button id="loginBtn">Log In</button>
    <button id="resetBtn">Reset Password</button>
  </div>

  <div id="user-card" class="card" style="display:none;">
    <p>Hello, <span id="uName"></span>! <span id="vipBadge" class="vip"></span></p>
    <p>Your PEC Balance: <span id="uCoins">0</span></p>
    <button id="dailyBtn">🎁 Daily Bonus</button>
    <button id="mineBtn">💰 Mine Coins</button>
    <button id="tapBtn">👆 Tap Tycoon (+2 PEC)</button>
    <button id="mathBtn">🧠 Math Mania (+3 PEC)</button>
    <button id="redeemBtn">💸 Redeem (VIP only)</button>
    <button id="logoutBtn">Logout</button>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.24.0/firebase-app.js";
    import {
      getAuth,
      createUserWithEmailAndPassword,
      signInWithEmailAndPassword,
      signOut,
      sendPasswordResetEmail,
      onAuthStateChanged
    } from "https://www.gstatic.com/firebasejs/9.24.0/firebase-auth.js";
    import {
      getFirestore, doc, setDoc, getDoc, updateDoc, serverTimestamp
    } from "https://www.gstatic.com/firebasejs/9.24.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDl0DNM_U1_S0pWGybdKml08eb-CUzFc48",
      authDomain: "paras-ecoin-ccb85.firebaseapp.com",
      projectId: "paras-ecoin-ccb85",
      storageBucket: "paras-ecoin-ccb85.appspot.com",
      messagingSenderId: "106833020083",
      appId: "1:106833020083:web:f43a025388e9e0c4201cc6"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const authCard = document.getElementById("auth-card");
    const userCard = document.getElementById("user-card");
    const emailIn = document.getElementById('email'), passIn = document.getElementById('password');
    const uName = document.getElementById('uName'), uCoins = document.getElementById('uCoins'), vipBadge = document.getElementById('vipBadge');

    document.getElementById('signupBtn').onclick = async () => {
      const email = emailIn.value, password = passIn.value;
      try { const cred = await createUserWithEmailAndPassword(auth, email, password);
        await setDoc(doc(db, 'users', cred.user.uid), {
          name: email.split('@')[0],
          email, isVIP: false, coins: 0, lastLogin: serverTimestamp()
        });
        alert('Registered!');
      } catch(e){ alert(e.message) }
    };
    document.getElementById('loginBtn').onclick = async () => {
      try { await signInWithEmailAndPassword(auth, emailIn.value, passIn.value); }
      catch(e){ alert(e.message) }
    };
    document.getElementById('resetBtn').onclick = () => {
      const email = emailIn.value;
      if (!email) return alert('Enter email');
      sendPasswordResetEmail(auth, email).then(() => alert('Reset link sent')).catch(e => alert(e.message));
    };
    document.getElementById('logoutBtn').onclick = () => signOut(auth);

    document.getElementById('dailyBtn').onclick = async () => {
      const u = auth.currentUser;
      const ud = await getDoc(doc(db, 'users', u.uid));
      const data = ud.data();
      const last = data.lastLogin? data.lastLogin.toDate().toDateString(): '';
      if (last === new Date().toDateString()) return alert('Already claimed today');
      const bonus = 10;
      await updateDoc(doc(db, 'users', u.uid), {
        coins: data.coins + bonus,
        lastLogin: serverTimestamp()
      });
      alert(`+${bonus} PEC`);
      loadProfile();
    };
    document.getElementById('mineBtn').onclick = async () => {
      const u = auth.currentUser;
      const ud = await getDoc(doc(db, 'users', u.uid));
      await updateDoc(doc(db, 'users', u.uid), {
        coins: ud.data().coins + 5
      });
      alert('+5 PEC');
      loadProfile();
    };
    document.getElementById('tapBtn').onclick = async () => {
      const u = auth.currentUser;
      const ud = await getDoc(doc(db,'users',u.uid));
      await updateDoc(doc(db,'users',u.uid), {
        coins: ud.data().coins + 2
      });
      alert('+2 PEC');
      loadProfile();
    };
    document.getElementById('mathBtn').onclick = async () => {
      const ans = prompt('3 + 5 = ?');
      if (ans == '8') {
        const u = auth.currentUser;
        const ud = await getDoc(doc(db,'users',u.uid));
        await updateDoc(doc(db,'users',u.uid), {
          coins: ud.data().coins + 3
        });
        alert('+3 PEC');
        loadProfile();
      } else alert('Wrong!');
    };
    document.getElementById('redeemBtn').onclick = async () => {
      const u = auth.currentUser;
      const ud = await getDoc(doc(db,'users',u.uid));
      const d = ud.data();
      if (!d.isVIP) return alert('VIP only');
      if (d.coins < 100) return alert('Minimum 100 PEC needed');
      const red = Math.floor(d.coins * 0.9);
      await updateDoc(doc(db,'users',u.uid), { coins: 0 });
      alert(`Redeemed ${red} PEC (10% charity)`);
      loadProfile();
    };

    function loadProfile() {
      const u = auth.currentUser;
      getDoc(doc(db, 'users', u.uid)).then(ud => {
        const d = ud.data();
        uName.textContent = d.name;
        uCoins.textContent = d.coins;
        vipBadge.textContent = d.isVIP ? '🌟 VIP' : '';
      });
    }

    onAuthStateChanged(auth, user => {
      if (user) {
        authCard.style.display = 'none';
        userCard.style.display = 'block';
        loadProfile();
      } else {
        authCard.style.display = 'block';
        userCard.style.display = 'none';
      }
    });
  </script>
</body>
</html>
