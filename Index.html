<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Paras Ecoin Web App</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script defer src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js"></script>
  <script defer src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js"></script>
  <script defer src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #0f172a;
      color: #fff;
      margin: 0;
      padding: 20px;
      text-align: center;
    }
    button {
      padding: 10px 20px;
      background-color: #4f46e5;
      color: white;
      border: none;
      border-radius: 8px;
      margin: 10px;
    }
    .vip {
      color: gold;
      font-weight: bold;
    }
  </style>
</head>
<body>

  <h1>PARAS ECOIN</h1>
  <p id="user-info"></p>
  <div id="auth-buttons">
    <button onclick="signIn()">Sign in with Google</button>
  </div>
  <div id="app" style="display:none;">
    <p>Balance: <span id="balance">0</span> PEC</p>
    <p>Status: <span id="vip-status">Free User</span></p>
    <button onclick="claimDailyBonus()">Claim Daily Bonus</button>
    <button onclick="tap()">Tap to Earn</button>
    <p>Total Taps: <span id="taps">0</span></p>
    <div id="vip-section" style="margin-top: 20px;">
      <h3>Redeem Section (VIP Only)</h3>
      <button onclick="redeem()">Redeem PEC</button>
    </div>
    <br>
    <button onclick="signOut()">Sign Out</button>
  </div>

  <script type="module">
  const firebaseConfig = {
  apiKey: "AIzaSyBVzkXwX5Fhwq-NiCWbC9ii8cq-5jPY3ac",
  authDomain: "paras-ecoin-bfad2.firebaseapp.com",
  projectId: "paras-ecoin-bfad2",
  storageBucket: "paras-ecoin-bfad2.firebasestorage.app",
  messagingSenderId: "315406512180",
  appId: "1:315406512180:web:a6330984e75cca65bc1a61"
};

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    let currentUser = null;

    auth.onAuthStateChanged(async (user) => {
      if (user) {
        currentUser = user;
        document.getElementById("auth-buttons").style.display = "none";
        document.getElementById("app").style.display = "block";
        document.getElementById("user-info").textContent = `Welcome, ${user.displayName}`;

        const userRef = db.collection("users").doc(user.uid);
        const doc = await userRef.get();
        if (!doc.exists) {
          await userRef.set({
            name: user.displayName,
            email: user.email,
            balance: 0,
            vip: false,
            dailyBonusClaimed: false,
            totalTaps: 0,
            lastLogin: new Date()
          });
        } else {
          const today = new Date().toDateString();
          const lastLogin = doc.data().lastLogin?.toDate().toDateString();
          if (lastLogin !== today) {
            await userRef.update({
              dailyBonusClaimed: false,
              lastLogin: new Date()
            });
          }
        }
        updateUI();
      } else {
        document.getElementById("auth-buttons").style.display = "block";
        document.getElementById("app").style.display = "none";
      }
    });

    async function updateUI() {
      const userRef = db.collection("users").doc(currentUser.uid);
      const doc = await userRef.get();
      const data = doc.data();
      document.getElementById("balance").textContent = data.balance;
      document.getElementById("taps").textContent = data.totalTaps;
      document.getElementById("vip-status").textContent = data.vip ? "VIP Member ✅" : "Free User ❌";
      document.getElementById("vip-status").className = data.vip ? "vip" : "";
      document.getElementById("vip-section").style.display = data.vip ? "block" : "none";
    }

    async function signIn() {
      const provider = new firebase.auth.GoogleAuthProvider();
      await auth.signInWithPopup(provider);
    }

    async function signOut() {
      await auth.signOut();
    }

    async function claimDailyBonus() {
      const userRef = db.collection("users").doc(currentUser.uid);
      const doc = await userRef.get();
      if (!doc.data().dailyBonusClaimed) {
        const bonus = Math.floor(Math.random() * 601) + 100;
        await userRef.update({
          balance: doc.data().balance + bonus,
          dailyBonusClaimed: true
        });
        alert(`You received ${bonus} PEC as Daily Bonus!`);
        updateUI();
      } else {
        alert("Daily Bonus already claimed!");
      }
    }

    async function tap() {
      const userRef = db.collection("users").doc(currentUser.uid);
      const doc = await userRef.get();
      await userRef.update({
        balance: doc.data().balance + 5,
        totalTaps: doc.data().totalTaps + 1
      });
      updateUI();
    }

    async function redeem() {
      const userRef = db.collection("users").doc(currentUser.uid);
      const doc = await userRef.get();
      if (!doc.data().vip) {
        alert("VIP only feature. Please upgrade.");
        return;
      }

      const currentBalance = doc.data().balance;
      if (currentBalance < 1000) {
        alert("Minimum 1000 PEC required for redeem.");
        return;
      }

      const redeemAmount = currentBalance;
      const charity = Math.floor(redeemAmount * 0.10);
      const finalAmount = redeemAmount - charity;

      await userRef.update({
        balance: 0
      });

      alert(`Redeemed ${redeemAmount} PEC (₹${redeemAmount / 100}). Charity Deducted: ${charity} PEC`);
      updateUI();
    }
  </script>
</body>
</html>
