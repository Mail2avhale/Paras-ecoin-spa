<!DOCTYPE html>
<html>
<head>
  <title>PARAS ECOIN Web App</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js"></script>
</head>
<body>
  <h2>👋 Welcome to PARAS ECOIN</h2>

  <div id="auth-section">
    <input type="email" id="email" placeholder="Email"><br>
    <input type="password" id="password" placeholder="Password"><br>
    <button onclick="signup()">Signup</button>
    <button onclick="login()">Login</button>
    <button onclick="resetPassword()">Forgot Password?</button>
    <br><br>
    <button onclick="logout()">Logout</button>
  </div>

  <div id="user-section" style="display:none;">
    <h3>User Profile</h3>
    <p>Name: <span id="user-name"></span></p>
    <p>Email: <span id="user-email"></span></p>
    <p>Coins: <span id="user-coins"></span></p>
    <p>VIP: <span id="user-vip"></span></p>
    <button onclick="dailyLoginBonus()">🎁 Claim Daily Bonus</button>
    <button onclick="mineCoins()">💰 Start Mining</button>
    <button onclick="tapTycoon()">🎮 Tap Tycoon</button>
    <button onclick="mathMania()">🧠 Math Mania</button>
    <button onclick="redeem()">🎁 Redeem Coins</button>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, sendPasswordResetEmail, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";
    import { getDatabase, ref, set, get, update } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDl0DNM_U1_S0pWGybdKml08eb-CUzFc48",
      authDomain: "paras-ecoin-ccb85.firebaseapp.com",
      projectId: "paras-ecoin-ccb85",
      storageBucket: "paras-ecoin-ccb85.appspot.com",
      messagingSenderId: "106833020083",
      appId: "1:106833020083:web:f43a025388e9e0c4201cc6",
      databaseURL: "https://paras-ecoin-ccb85-default-rtdb.firebaseio.com"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getDatabase(app);

    // 🔐 Signup
    window.signup = async function() {
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      const userCredential = await createUserWithEmailAndPassword(auth, email, password);
      const user = userCredential.user;
      await set(ref(db, 'users/' + user.uid), {
        uid: user.uid,
        name: email.split('@')[0],
        email: email,
        coins: 0,
        isVIP: false,
        lastLoginDate: "",
        activeReferrals: 0
      });
      alert("Signup Success");
    };

    // 🔐 Login
    window.login = async function() {
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      await signInWithEmailAndPassword(auth, email, password);
    };

    // 🔐 Reset Password
    window.resetPassword = async function() {
      const email = document.getElementById('email').value;
      await sendPasswordResetEmail(auth, email);
      alert("Password reset email sent");
    };

    // 🚪 Logout
    window.logout = async function() {
      await signOut(auth);
    };

    // 📌 On Auth State Change
    onAuthStateChanged(auth, async user => {
      if (user) {
        document.getElementById("auth-section").style.display = "none";
        document.getElementById("user-section").style.display = "block";

        const snap = await get(ref(db, 'users/' + user.uid));
        const data = snap.val();
        document.getElementById("user-name").textContent = data.name;
        document.getElementById("user-email").textContent = data.email;
        document.getElementById("user-coins").textContent = data.coins;
        document.getElementById("user-vip").textContent = data.isVIP ? "✅ Yes" : "❌ No";
      } else {
        document.getElementById("auth-section").style.display = "block";
        document.getElementById("user-section").style.display = "none";
      }
    });

    // 💰 Mining
    window.mineCoins = async function() {
      const user = auth.currentUser;
      const snap = await get(ref(db, 'users/' + user.uid));
      const coins = snap.val().coins || 0;
      const newCoins = coins + 5; // Fixed 5 PEC per mine
      await update(ref(db, 'users/' + user.uid), { coins: newCoins });
      alert("+5 PEC mined");
    };

    // 🧮 Daily Bonus
    window.dailyLoginBonus = async function() {
      const user = auth.currentUser;
      const today = new Date().toISOString().split('T')[0];
      const snap = await get(ref(db, 'users/' + user.uid));
      const data = snap.val();
      if (data.lastLoginDate === today) {
        alert("Bonus already claimed today");
      } else {
        const bonus = 10; // Fixed bonus
        await update(ref(db, 'users/' + user.uid), {
          coins: data.coins + bonus,
          lastLoginDate: today
        });
        alert("🎁 +10 PEC Daily Bonus");
      }
    };

    // 🎮 Tap Tycoon Game
    window.tapTycoon = async function() {
      const user = auth.currentUser;
      const snap = await get(ref(db, 'users/' + user.uid));
      const coins = snap.val().coins || 0;
      await update(ref(db, 'users/' + user.uid), { coins: coins + 2 });
      alert("TAP! +2 PEC");
    };

    // 🎮 Math Mania
    window.mathMania = async function() {
      const answer = prompt("Solve: 3 + 5 = ?");
      if (answer == "8") {
        const user = auth.currentUser;
        const snap = await get(ref(db, 'users/' + user.uid));
        const coins = snap.val().coins || 0;
        await update(ref(db, 'users/' + user.uid), { coins: coins + 3 });
        alert("Correct! +3 PEC");
      } else {
        alert("Wrong Answer");
      }
    };

    // 🎁 Redeem
    window.redeem = async function() {
      const user = auth.currentUser;
      const snap = await get(ref(db, 'users/' + user.uid));
      const data = snap.val();
      if (!data.isVIP) {
        alert("VIP only redemption allowed!");
        return;
      }
      if (data.coins < 100) {
        alert("Minimum 100 PEC required");
        return;
      }
      const redeemAmount = Math.floor(data.coins * 0.9);
      await update(ref(db, 'users/' + user.uid), {
        coins: 0,
        wallet: {
          redeemedAmount: (data.wallet?.redeemedAmount || 0) + redeemAmount
        }
      });
      alert("🎉 Redeemed " + redeemAmount + " PEC (10% Charity deducted)");
    };

  </script>
</body>
</html>
